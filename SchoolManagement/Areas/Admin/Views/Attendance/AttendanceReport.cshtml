@model IEnumerable<SchoolManagement.Models.StudentAttendance>
@{
    ViewData["Title"] = "Attendance Report";
    Layout = "~/Views/Shared/_SuperAdminLayout.cshtml";
    ViewBag.ActiveTabName = "Attendance";

    var standardId = Context.Request.Query["standardId"].ToString();
    var subjectId = Context.Request.Query["subjectId"].ToString();
    var fromDate = Context.Request.Query["fromDate"].ToString();
    var toDate = Context.Request.Query["toDate"].ToString();
}

<div class="container-fluid mt-2">
    <div class="card shadow-lg">
        <div class="card-header bg-primary text-white text-center">
            <h3 class="mb-1">
                <i class="fa fa-check-square"></i> Attendance Management System
            </h3>
        </div>

        <!-- Filter Form -->
        <form method="get" class="row align-items-end g-3 p-3">
            <div class="col-md-2 col-sm-6 mb-2">
                <h5 class="text-bold">From Date</h5>
                <input type="date" name="fromDate" value="@fromDate" class="form-control" />
            </div>
            <div class="col-md-2 col-sm-6 mb-2">
                <h5 class="text-bold">To Date</h5>
                <input type="date" name="toDate" value="@toDate" class="form-control" />
            </div>
            <div class="col-md-3 col-sm-6 mb-2">
                <h5 class="text-bold">Standard</h5>
                <select name="standardId" class="form-control"> <option value="">-- Select Standard --</option> @if (ViewBag.Standards != null)
                    {
                        foreach (var std in ViewBag.Standards)
                        {
                            if (standardId == std.UniqueId.ToString())
                            {
                                <option value="@std.UniqueId" selected="selected">@std.StandardName</option>
                            }
                            else
                            {
                                <option value="@std.UniqueId">@std.StandardName</option>
                            }
                        }
                    } </select>
            </div>
            <div class="col-md-3 col-sm-6 mb-2">
                <h5 class="text-bold">Subject</h5>
                <select name="subjectId" class="form-control">
                    <option value="">-- Select Subject --</option> @if (ViewBag.Subjects != null)
                    {
                        foreach (var sub in ViewBag.Subjects)
                        {
                            if (subjectId == sub.SubjectId.ToString())
                            {
                                <option value="@sub.SubjectId" selected="selected">@sub.SubjectName</option>
                            }
                            else
                            {
                                <option value="@sub.SubjectId">@sub.SubjectName</option>
                            }
                        }
                    }
                </select>
            </div>
            <div class="col-md-2 col-sm-12 mb-2">
                <button type="submit" class="btn btn-primary btn-block">
                    <i class="fa fa-search"></i> Search
                </button>
            </div>
        </form>

        <!-- Summary Cards -->
        <div class="row text-white mb-4 mx-2">
            <div class="col-md-3 col-sm-6 mb-2">
                <div class="card bg-success p-3 text-center">
                    <h5>Present</h5>
                    <h3>@ViewBag.TotalPresent</h3>
                </div>
            </div>
            <div class="col-md-3 col-sm-6 mb-2">
                <div class="card bg-danger p-3 text-center">
                    <h5>Absent</h5>
                    <h3>@ViewBag.TotalAbsent</h3>
                </div>
            </div>
            <div class="col-md-3 col-sm-6 mb-2">
                <div class="card bg-warning p-3 text-center">
                    <h5>Leave</h5>
                    <h3>@ViewBag.TotalLeave</h3>
                </div>
            </div>
            <div class="col-md-3 col-sm-6 mb-2">
                <div class="card bg-info p-3 text-center">
                    <h5>Total</h5>
                    <h3>@ViewBag.TotalRecords</h3>
                </div>
            </div>
        </div>

        <!-- Attendance Table -->
        <div class="card mx-2 mb-3">
            <div class="card-header bg-primary text-white">
                <i class="fa fa-list"></i> Attendance Details
            </div>
            <div class="card-body p-0 table-responsive">
                <table class="table table-bordered table-striped mb-0">
                    <thead class="bg-light">
                        <tr>
                            <th>Date</th>
                            <th>Student</th>
                            <th>Standard</th>
                            <th>Subject</th>
                            <th>Status</th>
                            <th>Remarks</th>
                        </tr>
                    </thead>
                    <tbody>
                        @foreach (var item in Model)
                        {
                            <tr>
                                <td>@item.Date.ToString("dd-MMM-yyyy")</td>
                                <td>@item.Student?.FullName</td>
                                <td>@item.Student?.Standard?.StandardName</td>
                                <td>@item.Subject?.SubjectName</td>
                                <td>
                                    @if (item.Remarks == "Leave")
                                    {
                                        <span class="badge badge-warning">Leave</span>
                                    }
                                    else if (item.IsPresent)
                                    {
                                        <span class="badge badge-success">Present</span>
                                    }
                                    else
                                    {
                                        <span class="badge badge-danger">Absent</span>
                                    }
                                </td>
                                <td>@item.Remarks</td>
                            </tr>
                        }
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</div>
