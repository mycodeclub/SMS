@model SchoolManagement.Models.DashboardVM
@{
    ViewData["Title"] = "Admin Dashboard";
    Layout = "~/Views/Shared/_SuperAdminLayout.cshtml";
    ViewBag.ActiveTabName = "FeeCollection";
}

<div class="container mt-3">
    <!-- Dashboard Header -->
    <div class="card shadow-sm border-primary mb-4">
        <div class="card-header bg-primary text-white fw-bold">
            <i class="bi bi-speedometer2 me-2"></i> Admin Dashboard
        </div>
    </div>

    <!-- Cards -->
    <div class="row g-4">
        <!-- Students -->
   
        <div class="col-md-3">
            <a asp-controller="FeeAssignment" asp-action="Students" class="text-decoration-none">
                <div class="card dashboard-card bg-gradient-primary text-white shadow-lg rounded-4 border-0 h-100">
                    <div class="card-body text-center">
                        <i class="bi bi-people fs-1 mb-2"></i>
                        <h6 class="text-light">Total Students</h6>
                        <h3 class="fw-bold">@Model.TotalStudents</h3>
                    </div>
                </div>
            </a>
        </div>

        <!-- Fees Collected -->
        <div class="col-md-3">
            <div class="card dashboard-card bg-gradient-success text-white shadow-lg rounded-4 border-0 h-100 clickable" data-type="collected">
                <div class="card-body text-center">
                    <i class="bi bi-cash-stack fs-1 mb-2"></i>
                    <h6 class="text-light">Fees Collected</h6>
                    <h3 class="fw-bold">₹@Model.TotalCollected</h3>
                </div>
            </div>
        </div>

        <!-- Fees Due -->
        <div class="col-md-3">
            <div class="card dashboard-card bg-gradient-danger text-white shadow-lg rounded-4 border-0 h-100 clickable" data-type="due">
                <div class="card-body text-center">
                    <i class="bi bi-exclamation-circle-fill fs-1 mb-2"></i>
                    <h6 class="text-light">Fees Due</h6>
                    <h3 class="fw-bold">₹@Model.TotalDue</h3>
                </div>
            </div>
        </div>

        <!-- Discount -->
        <div class="col-md-3">
            <div class="card dashboard-card bg-gradient-warning text-white shadow-lg rounded-4 border-0 h-100 clickable" data-type="discount">
                <div class="card-body text-center">
                    <i class="bi bi-percent fs-1 mb-2"></i>
                    <h6 class="text-light">Total Discount</h6>
                    <h3 class="fw-bold">₹@Model.TotalDiscount</h3>
                </div>
            </div>
        </div>
    </div>

    <!-- Data Section -->
    <div id="dataSection" class="mt-4" style="display:none;">
        <h4 class="mb-3" id="sectionTitle"></h4>
        <div id="dataContent"></div>
    </div>

    <!-- Student Detail Section -->
    <div id="studentDetailSection" class="mt-4" style="display:none;">
        <h4 class="mb-3">Student Details</h4>
        <div class="card shadow-sm border-0">
            <div class="card-body">
                <p><b>Name:</b> <span id="sName"></span></p>
                <p><b>Standard:</b> <span id="sStandard"></span></p>
                <p><b>Total Fees:</b> ₹<span id="sTotalFees"></span></p>
                <p><b>Discount:</b> ₹<span id="sDiscount"></span></p>
                <p><b>After Discount:</b> ₹<span id="sAfterDiscount"></span></p>
                <p><b>Paid:</b> ₹<span id="sPaid"></span></p>
                <p><b>Due:</b> ₹<span id="sDue"></span></p>
            </div>
        </div>
    </div>
</div>

<!-- Custom CSS -->
<style>
    .dashboard-card {
        transition: transform 0.3s ease, box-shadow 0.3s ease;
        cursor: pointer;
    }

        .dashboard-card:hover {
            transform: translateY(-6px);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.2);
        }

    .bg-gradient-primary {
        background: linear-gradient(135deg, #4e73df, #224abe);
    }

    .bg-gradient-success {
        background: linear-gradient(135deg, #1cc88a, #13855c);
    }

    .bg-gradient-danger {
        background: linear-gradient(135deg, #e74a3b, #b02a37);
    }

    .bg-gradient-warning {
        background: linear-gradient(135deg, #f6c23e, #d39e00);
    }
</style>

<!-- Bootstrap Icons CDN -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css">

@section Scripts {
    <script>
        // Card Click
        $(".clickable").on("click", function () {
            var type = $(this).data("type");

            if (type === "students") {
                $.getJSON("/FeeAssignment/GetStudents", function (data) {
                    $("#sectionTitle").text("Student List");
                    var html = `<table class="table table-bordered">
                                    <thead class="table-light">
                                        <tr>
                                            <th>Roll No</th>
                                            <th>Name</th>
                                            <th>Standard</th>
                                            <th>Action</th>
                                        </tr>
                                    </thead><tbody>`;
                    $.each(data, function (i, s) {
                        html += `<tr>
                                    <td>${s.rollNo}</td>
                                    <td>${s.name}</td>
                                    <td>${s.standard}</td>
                                    <td><button class="btn btn-sm btn-primary view-detail" data-id="${s.id}">View</button></td>
                                 </tr>`;
                    });
                    html += `</tbody></table>`;
                    $("#dataContent").html(html);
                    $("#dataSection").slideDown();
                    $("#studentDetailSection").hide();
                });
            }
            else if (type === "collected") {
                $.getJSON("/FeeAssignment/GetCollectedFees", function (data) {
                    $("#sectionTitle").text("Fees Collected");
                    $("#dataContent").html("<pre>" + JSON.stringify(data, null, 2) + "</pre>");
                    $("#dataSection").slideDown();
                    $("#studentDetailSection").hide();
                });
            }
            else if (type === "due") {
                $.getJSON("/Admin/FeeAssignment/GetDueFees", function (data) {
                    $("#sectionTitle").text("Fees Due");
                    $("#dataContent").html("<pre>" + JSON.stringify(data, null, 2) + "</pre>");
                    $("#dataSection").slideDown();
                    $("#studentDetailSection").hide();
                });
            }
            else if (type === "discount") {
                $.getJSON("/FeeAssignment/GetDiscounts", function (data) {
                    $("#sectionTitle").text("Discounts");
                    $("#dataContent").html("<pre>" + JSON.stringify(data, null, 2) + "</pre>");
                    $("#dataSection").slideDown();
                    $("#studentDetailSection").hide();
                });
            }
        });

        // Student Details View
        $(document).on("click", ".view-detail", function () {
            var id = $(this).data("id");
            $.getJSON("/Admin/FeeAssignment/GetStudentDetails/" + id, function (d) {
                $("#sName").text(d.name);
                $("#sStandard").text(d.standard);
                $("#sTotalFees").text(d.totalFees);
                $("#sDiscount").text(d.totalDiscount);
                $("#sAfterDiscount").text(d.afterDiscount);
                $("#sPaid").text(d.paid);
                $("#sDue").text(d.due);
                $("#studentDetailSection").slideDown();
            });
        });
    </script>
}
